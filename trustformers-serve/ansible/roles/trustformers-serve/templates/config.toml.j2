# TrustformeRS Serve Configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

[server]
host = "{{ app_host }}"
port = {{ app_port }}
workers = {{ worker_threads }}
max_connections = 1000

[grpc]
enabled = true
port = {{ grpc_port }}
max_message_size = "10MB"
keepalive_time = "30s"
keepalive_timeout = "5s"

[metrics]
enabled = {{ metrics_enabled | lower }}
port = {{ metrics_port }}
path = "/metrics"

[logging]
level = "{{ log_level }}"
format = "{{ log_format }}"
output = "file"
file_path = "{{ app_log_dir }}/trustformers-serve.log"

[database]
{% if database_enabled %}
enabled = true
url = "{{ database_url }}"
max_connections = 20
min_connections = 5
connection_timeout = "30s"
{% else %}
enabled = false
{% endif %}

[redis]
{% if redis_enabled %}
enabled = true
url = "{{ redis_url }}"
max_connections = 10
connection_timeout = "5s"
{% else %}
enabled = false
{% endif %}

[model]
cache_dir = "{{ app_models_dir }}"
max_cache_size = "10GB"
auto_download = {{ model_auto_download | lower }}
{% if model_registry_url %}
registry_url = "{{ model_registry_url }}"
{% endif %}

[inference]
max_batch_size = {{ max_batch_size }}
max_sequence_length = {{ max_sequence_length }}
timeout = "30s"
enable_streaming = true

[security]
jwt_secret = "{{ jwt_secret }}"
{% if api_keys %}
[security.api_keys]
{% for key, description in api_keys.items() %}
"{{ key }}" = "{{ description }}"
{% endfor %}
{% endif %}

{% if enable_ssl %}
[ssl]
enabled = true
cert_file = "{{ ssl_cert_path }}"
key_file = "{{ ssl_key_path }}"
{% if ssl_ca_path is defined %}
ca_file = "{{ ssl_ca_path }}"
{% endif %}
{% endif %}

[monitoring]
health_check_interval = {{ health_check_interval }}
metrics_collection_interval = 10
enable_profiling = false

[performance]
enable_gpu = false
gpu_device_id = 0
memory_pool_size = "{{ max_memory }}"
thread_pool_size = {{ worker_threads }}

[features]
enable_graphql = true
enable_websockets = true
enable_batch_processing = true
enable_streaming = true