# JitPack Configuration for TrustformeRS Mobile
# This configuration enables JitPack.io to build and distribute the Android library

# JDK version for building
jdk:
  - openjdk11

# Environment variables
env:
  - ANDROID_HOME=/opt/android-sdk-linux
  - PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools

# Install dependencies
install:
  # Install required Android SDK components
  - echo y | $ANDROID_HOME/tools/bin/sdkmanager "platforms;android-33"
  - echo y | $ANDROID_HOME/tools/bin/sdkmanager "build-tools;33.0.2"
  - echo y | $ANDROID_HOME/tools/bin/sdkmanager "cmake;3.18.1"
  - echo y | $ANDROID_HOME/tools/bin/sdkmanager "ndk;23.2.8568313"
  
  # Install Rust toolchain for native library compilation
  - curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  - source $HOME/.cargo/env
  - rustup target add aarch64-linux-android
  - rustup target add armv7-linux-androideabi
  - rustup target add i686-linux-android
  - rustup target add x86_64-linux-android
  
  # Make build scripts executable
  - chmod +x build-android.sh
  - chmod +x android-lib/gradlew

# Build configuration
before_install:
  - export ANDROID_NDK_HOME=$ANDROID_HOME/ndk/23.2.8568313
  - export ANDROID_SDK_ROOT=$ANDROID_HOME
  - export PATH=$PATH:$HOME/.cargo/bin

# Custom build script
script:
  - cd android-lib
  - ./gradlew clean assembleRelease publishToMavenLocal

# Module configuration
modules:
  - android-lib

# Artifacts configuration
artifacts:
  - build/outputs/aar/*.aar
  - build/libs/*.jar

# JitPack specific settings
jitpack:
  # Enable gradle wrapper
  gradle: true
  
  # Set working directory
  workdir: android-lib
  
  # Custom build target
  build_target: assembleRelease
  
  # Upload artifacts
  upload: true
  
  # Timeout (in minutes)
  timeout: 30
  
  # Memory settings
  memory: 4g
  
  # Enable caching
  cache: true
  
  # Build flavors
  flavors:
    - release
  
  # Dependencies to cache
  cache_dependencies:
    - .gradle
    - ~/.gradle
    - ~/.cargo
    - ~/.rustup